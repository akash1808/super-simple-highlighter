var _highlighter={create:function(range,id,className){"use strict";var span=document.createElement("SPAN");span.className=className instanceof Array?className.join(" "):className;var record={firstSpan:null,lastSpan:null};return this._doCreate(range,record,function(){var newSpan=span.cloneNode(!1);return record.firstSpan||(record.firstSpan=newSpan,record.firstSpan.id=id),record.lastSpan&&(record.lastSpan.nextSpan=newSpan),record.lastSpan=newSpan,newSpan.firstSpan=record.firstSpan,newSpan}),record.firstSpan},_doCreate:function(range,record,createWrapper){"use strict";if(!range.collapsed){var startSide=range.startContainer,endSide=range.endContainer,ancestor=range.commonAncestorContainer,dirIsLeaf=!0;if(0===range.endOffset){for(;!endSide.previousSibling&&endSide.parentNode!==ancestor;)endSide=endSide.parentNode;endSide=endSide.previousSibling}else endSide.nodeType===Node.TEXT_NODE?range.endOffset<endSide.nodeValue.length&&endSide.splitText(range.endOffset):range.endOffset>0&&(endSide=endSide.childNodes.item(range.endOffset-1));startSide.nodeType===Node.TEXT_NODE?range.startOffset===startSide.nodeValue.length?dirIsLeaf=!1:range.startOffset>0&&(startSide=startSide.splitText(range.startOffset),endSide===startSide.previousSibling&&(endSide=startSide)):range.startOffset<startSide.childNodes.length?startSide=startSide.childNodes.item(range.startOffset):dirIsLeaf=!1,range.setStart(range.startContainer,0),range.setEnd(range.startContainer,0);var done=!1,node=startSide;do{if(!(!dirIsLeaf||node.nodeType!==Node.TEXT_NODE||node.parentNode instanceof HTMLTableElement||node.parentNode instanceof HTMLTableRowElement||node.parentNode instanceof HTMLTableColElement||node.parentNode instanceof HTMLTableSectionElement)){var wrap=node.previousSibling;wrap&&wrap===record.lastSpan||(wrap=createWrapper(node),node.parentNode.insertBefore(wrap,node)),wrap.appendChild(node),node=wrap.lastChild,dirIsLeaf=!1}node!==endSide||endSide.hasChildNodes()&&dirIsLeaf||(done=!0),(node instanceof HTMLScriptElement||node instanceof HTMLStyleElement||node instanceof HTMLSelectElement)&&(dirIsLeaf=!1),dirIsLeaf&&node.hasChildNodes()?node=node.firstChild:null!==node.nextSibling?(node=node.nextSibling,dirIsLeaf=!0):null===node.nextSibling&&(node=node.parentNode,dirIsLeaf=!1)}while(!done)}},update:function(id,className){"use strict";var span=document.getElementById(id);if(!this._isHighlightSpan(span))return!1;className=className instanceof Array?className.join(" "):className;do span.className=className,span=span.nextSpan;while(this._isHighlightSpan(span));return!0},del:function(id){"use strict";function _merge(n){n.nodeType===Node.TEXT_NODE&&(n.nextSibling&&n.nextSibling.nodeType===Node.TEXT_NODE&&(n.textContent+=n.nextSibling.textContent,n.nextSibling.parentNode.removeChild(n.nextSibling)),n.previousSibling&&n.previousSibling.nodeType===Node.TEXT_NODE&&(n.previousSibling.textContent+=n.textContent,n.parentNode.removeChild(n)))}var span=document.getElementById(id);if(!this._isHighlightSpan(span))return!1;for(;this._isHighlightSpan(span);){for(;span.hasChildNodes();){var nodeNew=span.parentNode.insertBefore(span.firstChild,span);_merge(nodeNew)}var nodeRemovedPreviousSibling=span.previousSibling,nodeRemoved=span.parentNode.removeChild(span);nodeRemovedPreviousSibling&&_merge(nodeRemovedPreviousSibling),span=nodeRemoved.nextSpan}return!0},getRange:function(id){"use strict";for(var span=document.getElementById(id),range=document.createRange();this._isHighlightSpan(span);)range.collapsed&&range.setStartBefore(span),range.setEndAfter(span),span=span.nextSpan;return range},_isHighlightSpan:function(node){"use strict";return node&&node.nodeType===Node.ELEMENT_NODE&&"SPAN"===node.nodeName&&void 0!==node.firstSpan}};